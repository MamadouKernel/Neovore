@model Neovore.Web.Domain.Entities.Produit
@{
    ViewData["Title"] = "Modifier le produit";
    var categories = ViewBag.Categories as IEnumerable<Neovore.Web.Domain.Entities.CategorieProduit>;
}
<div class="page-header">
  <h1 class="page-title">Modifier le produit</h1>
  <p class="page-subtitle">@Model.Nom</p>
</div>

<div class="admin-card mb-4">
  <div class="card-body p-4">
    <form method="post" enctype="multipart/form-data">
      @Html.AntiForgeryToken()

      <div class="row g-4">
        <div class="col-md-6">
          <label class="form-label fw-bold">Nom du produit *</label>
          <input asp-for="Nom" class="form-control" />
          <span asp-validation-for="Nom" class="text-danger small"></span>
        </div>

        <div class="col-md-6">
          <label class="form-label fw-bold">Slug (auto si vide)</label>
          <input asp-for="Slug" class="form-control" />
          <small class="text-muted">Laissez vide pour régénérer</small>
        </div>

        <div class="col-md-6">
          <label class="form-label fw-bold">Catégorie *</label>
          <select asp-for="CategorieProduitId" class="form-select" required>
            <option value="">-- Sélectionner une catégorie --</option>
            @foreach (var cat in categories ?? Enumerable.Empty<Neovore.Web.Domain.Entities.CategorieProduit>())
            {
              <option value="@cat.Id">@cat.Nom</option>
            }
          </select>
          <span asp-validation-for="CategorieProduitId" class="text-danger small"></span>
        </div>

        <div class="col-md-6">
          <label class="form-label fw-bold">Prix</label>
          <input asp-for="Prix" type="number" step="0.01" class="form-control" />
        </div>

        <div class="col-12">
          <label class="form-label fw-bold">Description</label>
          <textarea asp-for="Description" class="form-control" rows="4"></textarea>
        </div>

        <div class="col-12">
          <label class="form-label fw-bold">Spécifications</label>
          <textarea asp-for="Specifications" class="form-control" rows="6"></textarea>
        </div>

        <div class="col-md-6">
          <label class="form-label fw-bold">Ajouter une image</label>
          <input type="file" name="imageFile" accept="image/*" class="form-control" />
          <small class="text-muted">Ajouter une nouvelle image au produit</small>
        </div>

        <div class="col-md-6">
          <label class="form-label fw-bold">Publié</label>
          <select asp-for="EstPublie" class="form-select">
            <option value="true">Oui</option>
            <option value="false">Non</option>
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label fw-bold">Commentaires activés</label>
          <select asp-for="CommentairesActives" class="form-select">
            <option value="true">Oui</option>
            <option value="false">Non</option>
          </select>
        </div>
      </div>

      <div class="mt-4 d-flex gap-2">
        <button class="btn btn-primary" type="submit">
          <i class="bi bi-check-circle me-2"></i>Enregistrer
        </button>
        <a class="btn btn-outline-secondary" href="/Admin/Produits">
          <i class="bi bi-x-circle me-2"></i>Annuler
        </a>
      </div>
    </form>
  </div>
</div>

@if (Model.Medias?.Any() == true)
{
  <div class="admin-card">
    <div class="card-body p-4">
      <h3 class="h5 fw-bold mb-4">
        <i class="bi bi-images me-2"></i>Images du produit
      </h3>
      <div class="row g-3">
        @foreach (var media in Model.Medias.OrderBy(m => m.Ordre))
        {
          <div class="col-md-3">
            <div class="position-relative">
              <img src="@media.Url" alt="@media.Alt" class="img-fluid rounded border" style="height: 150px; width: 100%; object-fit: cover;" />
              <form method="post" action="/Admin/Produits/DeleteMedia/@media.Id" class="position-absolute top-0 end-0 m-2">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Supprimer cette image ?');">
                  <i class="bi bi-trash"></i>
                </button>
              </form>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
}

@section Scripts {
  <partial name="_ValidationScriptsPartial" />
}

